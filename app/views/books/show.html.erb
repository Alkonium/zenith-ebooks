<p id="notice"><%= notice %></p>
<% @authors = Author.where(book_id: @book.id) %>
<% @authored = false %>
<p>
  <strong>Title:</strong>
  <%= @book.title %>
</p>

<p>
  <strong>Written by:</strong>
  <% @authors.each do |author| %>
    <% if author.user_id == session[:user_id] %>
	  <% @authored = true; %>
	<% end %>
    <%= link_to author.user.penName, author.user %><br/>
  <% end %>
</p>

<p>
  <strong>Price:</strong>
  <%= number_to_currency(@book.price, locale: :ca) %>
</p>

<p>
  <strong>Words:</strong>
  <%= @book.words %>
</p>

<p>
  <strong>Published:</strong>
  <%= @book.published %>
</p>

<p>
  <strong>Synopsis:</strong>
  <%= @book.synopsis %>
</p>
<% @purchase = Purchase.where(book_id: @book.id, user_id: session[:user_id]) %>
<% @incart = Cart.where(book_id: @book.id, user_id: session[:user_id]) %>
<% if @authored %>
  <%= link_to 'Edit', edit_book_path(@book) %> |
<% elsif @purchase.count == 0 && @incart.count == 0 %>
  <%= link_to 'Add to Cart', '#' %> |
  <%= link_to 'Buy Now', '#' %> |
<% elsif @purchase.count == 0 && @incart.count == 1 %>
  <%= link_to 'Remove from Cart', @incart.first, method: :delete, data: { confirm: 'Are you sure?' }  %> |
  <%= link_to 'Buy Now', '#' %> |
<% else %>
  <%= link_to 'Download as .mobi' %>
  <%= link_to 'Download as .epub' %>
  <%= link_to 'Download as .pdf' %>
<% end %>
<%= link_to 'Back', books_path %>
